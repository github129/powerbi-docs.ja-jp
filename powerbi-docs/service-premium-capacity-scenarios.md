---
title: Microsoft Power BI Premium 容量のシナリオ
description: Power BI Premium 容量の一般的なシナリオをについて説明します。
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 04/09/2019
ms.custom: seodec18
LocalizationGroup: Premium
ms.openlocfilehash: 1d666a6702515a935d93549d026f207848f2bca8
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2019
ms.locfileid: "65565350"
---
# <a name="premium-capacity-scenarios"></a>Premium 容量のシナリオ

この記事では、Power BI premium 容量が実装されている実際のシナリオについて説明します。 一般的な問題や課題についても説明しても、問題を特定する方法と、それらの解決に役立ちます。

- [データセットを最新に保つ](#keeping-datasets-up-to-date)
- [データセットの速度の遅い応答を識別します。](#identifying-slow-responding-datasets)
- [散発速度の遅い-応答の原因を特定するデータセット](#identifying-causes-for-sporadically-slow-responding-datasets)
- [十分なメモリがあるかどうかを決定します。](#determining-whether-there-is-enough-memory)
- [十分な CPU があるかどうかを決定します。](#determining-whether-there-is-enough-cpu)

グラフとテーブルの例も、手順は、**アプリの Power BI Premium 容量メトリック**Power BI 管理者がアクセスするには、します。

## <a name="keeping-datasets-up-to-date"></a>データセットを最新に保つ

このシナリオで、調査は、レポート データは、「古い」にすることもあります登場したユーザーが訴えていましたときにトリガーされました。

管理者の対話、アプリで、**更新**してデータセットを並べ替え、visual、**最大待機時間**降順で統計情報。 このビジュアルでは、ワークスペース名でグループ化された、最も長い待機時間のデータセットを表示できます。

![ワークスペースでグループ化、最大待機時間の降順で並べ替えたデータセット更新](media/service-premium-capacity-scenarios/dataset-refreshes.png)

**1 時間あたり平均更新待機時間**更新の待機時間は約 4 PM 毎日でピーク一貫した方法がわかりますがビジュアルでは、します。

![更新は、午後 4 時に定期的にピークを待機します。](media/service-premium-capacity-scenarios/peak-refresh-waits.png)

これらの結果の可能性のあるいくつかの説明があります。

- 更新の回数が多すぎるは容量ノードで定義されている制限を超えると、同時に発生する可能性です。 この場合、既定のメモリ割り当てと P1 の 6 つの同時実行更新です。

- データセットを更新するのには、(少なくとも 2 倍の完全な更新に必要なメモリが必要)、使用可能なメモリに収まるようには大きすぎる可能性があります。
- Power Query の非効率的なロジックは、データセットの更新中にメモリ使用量の急増に結果可能性があります。 ビジー状態の容量でこのスパイクは、更新が失敗し、可能性のある、容量の他のレポート ビューの操作に影響は、物理的な制限を場合によっては到達できます。
- メモリに常駐させる必要があるクエリ対象のデータセットには、使用可能なメモリの制限のために更新するその他のデータセットの影響を与える可能性があります。

調査に役立つ、Power BI 管理者はことができますを探します。

- 時データの使用可能なメモリの不足は、使用可能なメモリが 2 倍を更新するデータセットのサイズより小さい場合に更新します。
- データセットがされている更新されず、更新する前にメモリではなくまだ開始されて負荷の高い更新時間中に対話型のトラフィックを表示します。 データセットの領域にある任意の時点で、メモリに読み込まれるデータセットを表示するには、Power BI 管理者が確認できます**データセット** タブで、アプリ。 管理者の横棒の 1 つをクリックしてフィルターを特定の時点を越えることができるし、 **1 時間ごとの読み込まれたデータセット カウント**します。 、次の図に示すように、ローカルのスパイクは、複数のデータセットが、スケジュールされた更新の起動を遅らせることがメモリに読み込まれるときに 1 時間を示します。
- 増加データセット立ち退き数を開始するデータの更新がスケジュールされているときに配置します。 立ち退き数は、メモリ負荷が高いによる更新の時刻より前に多すぎるのさまざまな対話型レポートを提供しているが指定できます。 **1 時間ごとのデータセットの立ち退き数とメモリ消費量**visual が立ち退き数の急増を明確に示すことができます。

次の図では、ローカルのスパイクは、読み込まれたデータセットで、更新の開始対話型クエリを実行することが遅延します。 期間を選択すると、 **1 時間ごとの読み込まれたデータセット カウント**ビジュアルがクロス フィルター、**データセット サイズ**visual します。

![読み込まれたデータセット内のローカルのスパイクの更新の対話型クエリの遅延起動を提案します。](media/service-premium-capacity-scenarios/hourly-loaded-dataset-counts.png)

Power BI 管理者は、十分なメモリがまずデータの更新に使用できることを確認する手順を実行して問題を解決する試行します。

- スケジュールは、データセットへの接続に時差を設定して、データを空間の所有者とするよう求めるから更新します。
- データセットを減らすことの不要なダッシュ ボードまたはダッシュ ボードを削除することによってクエリの負荷を並べて表示、特に行レベル セキュリティを適用します。
- Power Query のロジックを最適化することによって、データの更新を高速化します。 計算列またはテーブルをモデル化が向上します。 データセットのサイズを減らすか、データの増分更新を実行する大規模なデータセットを構成します。

## <a name="identifying-slow-responding-datasets"></a>データセットの速度の遅い応答を識別します。

ユーザーは、特定のレポートを開くには、長すぎるれた訴えていましたときにこのシナリオで、調査の開始時点がハングします。

アプリでは、Power BI 管理者が使用できます、**クエリ期間**データセットを降順で並べ替えることでパフォーマンスの低いデータセットを決定する visual**の平均実行時間**します。 このビジュアルも説明データセット クエリの数のデータセットをクエリする頻度を確認できるようにします。

![パフォーマンスの低いデータセット](media/service-premium-capacity-scenarios/worst-performing-datasets.png)

管理者を参照できます、**クエリ期間分布**バケット化クエリのパフォーマンスの全体的な分布を示すビジュアルでは、(< = 30、0 ~ 100 ミリ秒) のフィルター選択された期間。 クエリの take 1 秒または以下と見なされる応答性の高いほとんどのユーザーによって一般に、長い時間がかかるクエリは、パフォーマンスが低下したという認識を作成する傾向があります。

**1 時間あたりのクエリ期間分布**と容量のパフォーマンスでしたが認識されていた 1 時間の期間を識別するために、Power BI 管理者は、低下として visual します。 大きいほど、バー セグメントを表すクエリを実行する、1 秒、大きい方の期間ユーザーがパフォーマンスの低下を感じることのリスクです。

ビジュアルは対話型、および、バーのセグメントを選択すると、対応する**クエリ期間**ビジュアル、レポート ページ上の表は、クロス フィルター処理を表すデータセットを表示します。 このクロス フィルターにより、簡単に識別するために、Power BI 管理者のデータセットからの応答が緩やかに変化します。

次の図は、ビジュアルでフィルター処理された**クエリ期間の 1 時間あたりのディストリビューション**、1 時間のバケットでパフォーマンスの低いデータセットにフォーカスします。 

![フィルター選択された時間クエリ期間のディストリビューション visual データセットを実行する最悪の場合を示しています。](media/service-premium-capacity-scenarios/hourly-query-duration-distributions.png)

特定の 1 時間の期間のパフォーマンス低下のデータセットが識別されると、Power BI 管理者はパフォーマンスの低下が、オーバー ロードされた量が原因で発生やが不十分なため、データセットまたはレポートを設計するかどうかを調査できます。 参照できる、**クエリの待機時間**visual、および平均クエリの待機時間の降順で並べ替えデータセット。 クエリの大部分が待機している場合、データセットの高い需要はこのが多すぎるクエリの待機の原因である可能性があります。 平均のクエリは、時間を待機している場合は、大きな (> 100 ミリ秒)、データセットとレポートを最適化できるかどうかは表示して確認する価値がある可能性があります。 たとえば、少数のビジュアルには、レポート ページまたは DAX 式の最適化が与えられます。

![クエリの待機時間のビジュアルがパフォーマンスの低いデータセットの発見に役立ちます](media/service-premium-capacity-scenarios/query-wait-times.png)

これにはいくつかの可能なデータセットにクエリの待機時間の蓄積された理由があります。

- 準最適なモデル設計、メジャー式の場合、またはレポートも設計 - すべての状況に役立つ高レベルの CPU を消費するクエリの実行時間が長い。 これにより、新しいクエリを待つ CPU スレッドが使用可能になるし、営業時間中によく見られますコンボイ効果 (紙詰まりを考えてみてくださいトラフィック) を作成することができます。 **クエリが待機**データセットに高の平均クエリの待機時間があるかどうかを決定する主なリソースがページになります。
- 多数の同時実行の容量のユーザー (数百数千から) 同じレポートまたはデータセットを使用します。 同時実行のしきい値を超えていますが正しくないでも適切に設計されたデータセットを実行できます。 これは通常、他のデータセットの表示よりもクエリの数の大幅な向上値を示す 1 つのデータセットによって示されます (300 K のクエリと比較して 1 つのデータセットのたとえば、< その他のすべてのデータセットに対するクエリを 30 K)。 いくつかの時点で、クエリが待機の時差を設定すると、このデータセットが開始されますで表示される、**クエリ期間**ビジュアル。
- 多く異種クエリされるデータセット同時に、データセットが頻繁にメモリとの間サイクル スラッシングの原因です。 これにより、データセットがメモリに読み込まれると、パフォーマンスの低下が発生しているユーザー。 確認には、Power BI 管理者を参照できます、 **1 時間ごとのデータセットの立ち退き数とメモリ消費量**ビジュアルでは、多数のデータセットがメモリに読み込まれることであることを示す、繰り返し無効になっています。

## <a name="identifying-causes-for-sporadically-slow-responding-datasets"></a>散発速度の遅い-応答の原因を特定するデータセット

このシナリオでは、ユーザーには、レポートのビジュアルが場合がありますが、応答速度が遅いまたは応答しなくなる可能性がありますがそれ以外の時間が許容応答性の高いことが説明されているときに、調査を開始しました。

アプリで、**クエリ期間**セクションは、次のようにその原因データセットの検索に使用されました。

- **クエリ期間**visual 管理者 (最上位にクエリされるデータセットから始まります) データセットでデータセットをフィルター処理、調査のクロス フィルター処理された横棒、**クエリの 1 時間あたりのディストリビューション**ビジュアル。
- 1 つの 1 時間バーがそのデータセットの場合は、他の 1 時間バーとすべてのクエリ期間のグループ間の比率で大幅な変更を表示するときに (たとえば、比率、色の間変更大幅に)、このデータセットで散発的な変更の説明になります。パフォーマンス。
- パフォーマンスの低いクエリ、の不規則な部分を示す、1 時間のバーには、そのデータセットが他のデータセットのアクティビティに起因、ノイズの多い近隣の効果を受ける timespan が示されます。

1 時間で 1 月 30 日に、次のイメージ、データセットのパフォーマンスに重要な修正が発生場所によって示される、バケットのサイズ"(3,10s]"の実行期間。 その 1 時間バーをクリックすると、すべてのデータセットで、メモリに読み込まれる迷惑な隣人の効果を原因と考えられるデータセットを表示が表示されます。

![バーの大部分での最低パフォーマンスの表示](media/service-premium-capacity-scenarios/worst-performing-queries.png)

問題のある期間が識別されると (たとえば、中に 1 月 30日上の図で)、Power BI 管理者はすべてのデータセット フィルターを削除し、データセットがこの期間中にアクティブに照会されましたかを判断するには、その timespan でのみフィルター処理できます。 迷惑な隣人効果の犯人データセットは、最上位のクエリのデータセットまたは平均クエリ時間が最長の実行時間に 1 つは、通常が。

この問題を解決は、別の Premium 容量、またはデータセットのサイズ、使用量の要件、およびデータ更新のパターンと共有された容量別のワークスペースにデータセットがサポートされている原因を配布できます。

逆はも true 可能性があります。 Power BI 管理者は、データセット クエリのパフォーマンスが劇的に向上させる回数を確認し、何が消えてを探しますでした。 特定の情報がその時点で不足している場合は、原因となる問題をポイントするヘルプ可能性があります。

## <a name="determining-whether-there-is-enough-memory"></a>十分なメモリがあるかどうかを決定します。

容量のワークロードを完了するのに十分なメモリがあるかどうかを確認するのには、Power BI 管理者を参照できます、**消費されるメモリの割合**で visual、**データセット**アプリのタブ。 **すべて**(合計) のメモリがかどうかは積極的にクエリを実行、または処理に関係なく、メモリに読み込まれるデータセットによって消費されるメモリを表します。 **アクティブな**メモリがアクティブに処理されているデータセットによって消費されるメモリを表します。

正常な容量のビジュアルはすべて (合計) 間のギャップを示す、このようになりますが、アクティブなメモリ。

![正常な容量がすべて (合計) 間のギャップを表示して、アクティブなメモリ](media/service-premium-capacity-scenarios/memory-healthy-capacity.png)

メモリ不足が発生している容量を同じビジュアルはアクティブなメモリと合計のメモリが収束して、それは、追加のデータセットをメモリに読み込むことはできません明確に表示されます。 この場合、Power BI 管理者をクリックして**容量再起動**(で**オプションの高度な**管理者ポータルの容量設定領域の)。 メモリからフラッシュされ、(クエリまたはデータの更新) を必要に応じてメモリに再読み込みすることができますにされているすべてのデータセットで容量の結果を再起動しています。

![* * 統合されているメモリのアクティブな * * * * * すべてのメモリ](media/service-premium-capacity-scenarios/memory-unhealthy-capacity.png)

## <a name="determining-whether-there-is-enough-cpu"></a>十分な CPU があるかどうかを決定します。

一般に、80% を下回る容量の平均 CPU 使用率のままです。 この値を超える CPU の飽和が容量に近づいているを意味します。

CPU の飽和の効果は、容量のすべての操作を処理しようとすると、多くの CPU のコンテキスト スイッチを実行するため、必要以上にかかって操作によって表現されます。 高いクエリ待機時間によってはこれが多数の同時実行クエリの Premium 容量で示されます。 高いクエリ待機時間の結果とは、通常よりも低速の応答性です。 Power BI 管理者は、簡単に表示することで、CPU が飽和状態とを識別できます、**時間クエリ待機時間のディストリビューション**ビジュアル。 ピーク時に定期的なクエリは待機時間のカウントが潜在的な CPU の飽和を示すためです。

![定期的なピーク時にクエリの待機時間のカウントは、潜在的な CPU の飽和を示します](media/service-premium-capacity-scenarios/peak-query-wait-times.png)

同様のパターンは CPU の飽和に寄与している場合、バック グラウンド操作で検出場合があります。 Power BI 管理者は、(おそらく他の継続的なデータセットの更新や対話型クエリを使用して) のため、時に CPU の飽和を示すことができます、特定のデータセットの更新時間で定期的な急増を検索できます。 この場合を参照する、**システム**アプリ ビュー必ずしも CPU が 100% であります。 **システム**1 時間あたりの平均値が表示されますが、CPU できます飽和状態になったの数分間の負荷の高い操作では、待機時間で急増として表示します。

CPU の飽和の効果を表示する複数の微妙な差異があります。 待機クエリの数は重要ですが、クエリの待機時間はある程度はっきりパフォーマンスの低下を発生させることがなく常に実行されます。 (クエリの平均時間を長く、複雑かサイズを示す) によるデータセットの一部が他よりも CPU の飽和の効果をやすい。 これらのデータセットを簡単に識別するには、Power BI 管理者を確認のバーの色の構成の変更について、**時間単位の待機時間の分布**ビジュアル。 外れ値のバーを発見した後は検索クエリの待機期間中に含まれていたデータセットとクエリの実行時間の平均と比較して平均クエリの待機時間を見てもできます。 これら 2 つのメトリックは同じ大きさであり、データセットのクエリ ワークロードは容易ではときに、CPU が不足していますが、データセットが影響を受ける可能性が高いです。

この影響は、結果の各バースト中に CPU の飽和状態 (たとえば、トレーニング セッション) で複数のユーザーごとの頻度の高いクエリの短いバーストで、データセットが使用されるときに、特によくわかります。 この場合、このデータセットで重要なクエリの待機時間の場合は、容量 (迷惑な隣人影響) で他のデータセット上に影響を与えるとが発生することができます。

Power BI 管理者には、場合によっては、データセットの所有者が、以下を作成することを要求できます揮発性のクエリ ワークロードをレポートではなく (任意のデータセットを定期的にクエリがキャッシュされたタイルの更新) ダッシュ ボードを作成します。 これにより、ダッシュ ボードが読み込まれるときにスパイクを防ぐのに役立ちます。 このソリューション可能性がありますことができるとは限りませんの特定のビジネスの要件が、データセットに変更を加えずに、CPU の飽和を回避するために効果的な方法であることができます。

## <a name="acknowledgements"></a>受信確認

この記事の執筆者、Peter Myers、データ プラットフォームの MVP および独立系の BI エキスパートと[ソリューションではビット演算](https://www.bitwisesolutions.com.au/)します。

## <a name="next-steps"></a>次の手順

> [!div class="nextstepaction"]
> [アプリが Premium 容量を監視します。](service-admin-premium-monitor-capacity.md)    
> [!div class="nextstepaction"]
> [管理ポータルでの容量を監視します。](service-admin-premium-monitor-portal.md)   

他にわからないことがある場合は、 [Power BI コミュニティで質問してみてください](https://community.powerbi.com/)。

||||||